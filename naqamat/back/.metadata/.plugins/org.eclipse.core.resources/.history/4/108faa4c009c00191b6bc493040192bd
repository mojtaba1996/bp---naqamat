package ir.asta.training.contacts.services.impl;

import java.io.File;
import java.util.List;

import javax.inject.Inject;
import javax.inject.Named;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.ws.rs.core.Context;

import ir.asta.training.contacts.entities.QariEntity;
import ir.asta.training.contacts.entities.QiraatEntity;
import ir.asta.training.contacts.entities.SurahEntity;
import ir.asta.training.contacts.manager.AdminManager;
import ir.asta.training.contacts.manager.AuthManager;
import ir.asta.training.contacts.services.AdminService;
import ir.asta.wise.core.datamanagement.ActionResult;
import requestEntities.AddQariRequest;
import requestEntities.AddQiraatRequest;
import requestEntities.AddSurahRequest;
import utils.Functions;
import utils.Settings;
import utils.Roles;

@Named("adminService")
public class AdminServiceImpl implements AdminService {
	
	@Context HttpServletRequest request;
	@Context HttpServletResponse response;
	@Inject AdminManager manager;
	
	Functions functions = new Functions();
	Settings settings = new Settings();
	Roles roles = new Roles();

	@Override
	public ActionResult<List<SurahEntity>> getAllSurahs(String token) {
		ActionResult<List<SurahEntity>> answer = new ActionResult<List<SurahEntity>>();
		if(functions.isNull(request.getSession().getAttribute("token"))){
			answer.setSuccess(false);
			answer.setMessage(settings.LOGIN_FIRST);
		}else if(functions.ckeckToken(request.getSession().getAttribute("token"), token)){
			if(functions.isAdmin(request.getSession().getAttribute("role"))){
				answer.setData(manager.getAllSurahs());
				answer.setSuccess(true);
			}
			else{
				answer.setSuccess(false);
				answer.setMessage(settings.ACCESS_DENIED);
			}
		}else{
			answer.setSuccess(false);
			answer.setMessage(settings.TOKEN_DOES_NOT_MATCH);
		}
		return answer;
	}

	@Override
	public ActionResult<Boolean> addSurah(AddSurahRequest asReq) {
		ActionResult<Boolean> answer = new ActionResult<Boolean>();
		if (functions.isNull(request.getSession().getAttribute("token"))){
			answer.setSuccess(false);
			answer.setMessage(settings.LOGIN_FIRST);
		}else if(functions.ckeckToken(request.getSession().getAttribute("token"), asReq.getToken())){
			if(functions.isAdmin(request.getSession().getAttribute("role"))){
				answer.setData(manager.addNewSurah(asReq.getSurah()));
				if (answer.getData()){
					answer.setSuccess(true);
				}else{
					answer.setSuccess(false);
					answer.setMessage("خطا رخ داد");
				}
				
			}else{
				answer.setSuccess(false);
				answer.setMessage(settings.ACCESS_DENIED);
			}
		}else{
			answer.setSuccess(false);
			answer.setMessage(settings.TOKEN_DOES_NOT_MATCH);
		}
		return answer;
	}

	@Override
	public ActionResult<List<QariEntity>> getAllQaries(String token) {
		ActionResult<List<QariEntity>> answer = new ActionResult<List<QariEntity>>();
		if(functions.isNull(request.getSession().getAttribute("token"))){
			answer.setSuccess(false);
			answer.setMessage(settings.LOGIN_FIRST);
		}else if(functions.ckeckToken(request.getSession().getAttribute("token"), token)){
			if(functions.isAdmin(request.getSession().getAttribute("role"))){
				answer.setData(manager.getAllQaries());
				answer.setSuccess(true);
			}
			else{
				answer.setSuccess(false);
				answer.setMessage(settings.ACCESS_DENIED);
			}
		}else{
			answer.setSuccess(false);
			answer.setMessage(settings.TOKEN_DOES_NOT_MATCH);
		}
		return answer;
	}

	@Override
	public ActionResult<Boolean> addQari(AddQariRequest addQariRequest) {
		ActionResult<Boolean> answer = new ActionResult<Boolean>();
		if (functions.isNull(request.getSession().getAttribute("token"))){
			answer.setSuccess(false);
			answer.setMessage(settings.LOGIN_FIRST);
		}else if(functions.ckeckToken(request.getSession().getAttribute("token"), addQariRequest.getToken())){
			if(functions.isAdmin(request.getSession().getAttribute("role"))){
				answer.setData(manager.addNewQari(addQariRequest.getQari()));
				if (answer.getData()){
					answer.setSuccess(true);
				}else{
					answer.setSuccess(false);
					answer.setMessage("خطا رخ داد");
				}
				
			}else{
				answer.setSuccess(false);
				answer.setMessage(settings.ACCESS_DENIED);
			}
		}else{
			answer.setSuccess(false);
			answer.setMessage(settings.TOKEN_DOES_NOT_MATCH);
		}
		return answer;
	}

	@Override
	public ActionResult<List<QiraatEntity>> getAllQiraats(String token) {
		ActionResult<List<QiraatEntity>> answer = new ActionResult<List<QiraatEntity>>();
		if(functions.isNull(request.getSession().getAttribute("token"))){
			answer.setSuccess(false);
			answer.setMessage(settings.LOGIN_FIRST);
		}else if(functions.ckeckToken(request.getSession().getAttribute("token"), token)){
			if(functions.isAdmin(request.getSession().getAttribute("role"))){
				answer.setData(manager.getAllQiraats());
				answer.setSuccess(true);
			}
			else{
				answer.setSuccess(false);
				answer.setMessage(settings.ACCESS_DENIED);
			}
		}else{
			answer.setSuccess(false);
			answer.setMessage(settings.TOKEN_DOES_NOT_MATCH);
		}
		return answer;
	}

	@Override
	public ActionResult<Boolean> addQiraat(AddQiraatRequest addQiraatRequest) {
		System.out.println(addQiraatRequest.getQiraat().getSurahs().get(1));
		return null;
		ActionResult<Boolean> answer = new ActionResult<Boolean>();
		if (functions.isNull(request.getSession().getAttribute("token"))){
			answer.setSuccess(false);
			answer.setMessage(settings.LOGIN_FIRST);
		}else if(functions.ckeckToken(request.getSession().getAttribute("token"), addQiraatRequest.getToken())){
			if(functions.isAdmin(request.getSession().getAttribute("role"))){
				answer.setData(manager.addNewQiraat(addQiraatRequest.getQiraat()));
				if (answer.getData()){
					answer.setSuccess(true);
				}else{
					answer.setSuccess(false);
					answer.setMessage("خطا رخ داد");
				}
				
			}else{
				answer.setSuccess(false);
				answer.setMessage(settings.ACCESS_DENIED);
			}
		}else{
			answer.setSuccess(false);
			answer.setMessage(settings.TOKEN_DOES_NOT_MATCH);
		}
		return answer;
	}

	@Override
	public void deleteQiraat(String qiraat_id) {
		manager.deleteQiraatById(Long.parseLong(qiraat_id));
	}
	

}
